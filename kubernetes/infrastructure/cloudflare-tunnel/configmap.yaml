apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: cloudflare-tunnel
  labels:
    app: cloudflared
data:
  config.yaml: |
    # Tunnel identifier - must match your tunnel name in Cloudflare
    tunnel: homelab-k8s-tunnel
    
    # Token will be provided via TUNNEL_TOKEN environment variable
    # No credentials-file needed when using token authentication
    
    # Metrics server for monitoring
    metrics: 0.0.0.0:2000
    
    # Logging
    loglevel: info
    
    # Ingress rules define how traffic is routed
    ingress:
      # Homepage
      - hostname: home.lab.ripcloud.io
        service: http://homepage.homepage.svc.cluster.local:80
      
      # Grafana
      - hostname: grafana.lab.ripcloud.io
        service: http://kube-prometheus-stack-grafana.monitoring.svc.cluster.local:80
      
      # Prometheus
      - hostname: prometheus.lab.ripcloud.io
        service: http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090
      
      # Alertmanager
      - hostname: alertmanager.lab.ripcloud.io
        service: http://kube-prometheus-stack-alertmanager.monitoring.svc.cluster.local:9093
      
      # Demo nginx
      - hostname: demo.lab.ripcloud.io
        service: http://nginx-demo.default.svc.cluster.local:80
      
      # Uptime Kuma
      - hostname: status.lab.ripcloud.io
        service: http://uptime-kuma.uptime-kuma.svc.cluster.local:3001
      
      # Kubernetes Dashboard
      - hostname: dashboard.lab.ripcloud.io
        service: http://kubernetes-dashboard.kubernetes-dashboard.svc.cluster.local:443
        originServerName: kubernetes-dashboard.kubernetes-dashboard.svc.cluster.local
      
      # ArgoCD
      - hostname: argocd.lab.ripcloud.io
        service: http://argocd-server.argocd.svc.cluster.local:80
      
      # Harbor
      - hostname: harbor.lab.ripcloud.io
        service: http://harbor.harbor.svc.cluster.local:80
      
      # Catch-all rule - MUST be last
      - service: http_status:404
